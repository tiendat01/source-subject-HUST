--Bài thực hành số 2
--Nguyễn Tiến Đạt - 20194242
USE QLBongDa_DatNT_4242;
--a. Truy vấn cơ bản
--1. Cho biết thông tin (mã cầu thủ, họ tên, số áo, vị trí, ngày sinh, địa chỉ) của tất cả các cầu thủ
SELECT MACT_4242, HOTEN_4242, SO_4242, VITRI_4242, NGAYSINH_4242, DIACHI_4242
FROM CAUTHU_DatNT;

--2. Hiển thị thông tin tất cả các cầu thủ có số áo là 7 chơi ở vị trí Tiền vệ
SELECT * 
FROM CAUTHU_DatNT
WHERE SO_4242 = 7 AND VITRI_4242 = N'Tiền vệ';

--3. Cho biết tên, ngày sinh, địa chỉ, điện thoại của tất cả các huấn luyện viên.
SELECT TENHLV_4242, NGAYSINH_4242, DIACHI_4242, DIENTHOAI_4242
FROM HUANLUYENVIEN_DatNT;

--4. Hiển thi thông tin tất cả các cầu thủ có quốc tịch Việt Nam thuộc câu lạc bộ Becamex Bình Dương
SELECT CAUTHU_DatNT.*
FROM CAUTHU_DatNT, QUOCGIA_DatNT, CAULACBO_DatNT
WHERE CAUTHU_DatNT.MAQG_4242 = QUOCGIA_DatNT.MAQG_4242
AND QUOCGIA_DatNT.TENQG_4242 = N'Việt Nam'
AND CAUTHU_DatNT.MACLB_4242 = CAULACBO_DatNT.MACLB_4242
AND CAULACBO_DatNT.TENCLB_4242 = N'Becamex Bình Dương';

--5. Cho biết mã số, họ tên, ngày sinh, địa chỉ và vị trí của các cầu thủ thuộc đội bóng ‘SHB Đà Nẵng’ có quốc tịch “Bra-xin”
SELECT MACT_4242, HOTEN_4242, DIACHI_4242, VITRI_4242
FROM ((CAUTHU_DatNT
INNER JOIN CAULACBO_DatNT ON CAUTHU_DatNT.MACLB_4242 = CAULACBO_DatNT.MACLB_4242)
INNER JOIN QUOCGIA_DatNT ON CAUTHU_DatNT.MAQG_4242 = QUOCGIA_DatNT.MAQG_4242)
WHERE TENCLB_4242 = N'SHB Đà Nẵng' AND TENQG_4242 = N'Bra-xin';

INSERT INTO CAUTHU_DatNT (HOTEN_4242, VITRI_4242, NGAYSINH_4242, DIACHI_4242, MACLB_4242, MAQG_4242, SO_4242)
VALUES (N'Nguyễn Tiến Đạt 20194242', N'Tiền đạo', '2001-6-9', NULL, 'GDT', 'VN', 10);
--6. Hiển thị thông tin tất cả các cầu thủ đang thi đấu trong câu lạc bộ có sân nhà là “Long An”
SELECT CAUTHU_DatNT.*
FROM ((CAUTHU_DatNT
INNER JOIN CAULACBO_DatNT ON CAULACBO_DatNT.MACLB_4242 = CAUTHU_DatNT.MACLB_4242)
INNER JOIN SANVD_DatNT ON CAULACBO_DatNT.MASAN_4242 = SANVD_DatNT.MASAN_4242)
WHERE TENSAN_4242 = N'Long An';

--7. Cho biết kết quả (MATRAN, NGAYTD, TENSAN, TENCLB1, TENCLB2, KETQUA) các trận đấu vòng 2 của mùa bóng năm 2009
SELECT MATRAN_4242, NGAYTD_4242, TENSAN_4242, c1.TENCLB_4242, c2.TENCLB_4242, KETQUA_4242
FROM (((TRANDAU_DatNT 
INNER JOIN SANVD_DatNT ON TRANDAU_DatNT.MASAN_4242 = SANVD_DatNT.MASAN_4242)
INNER JOIN CAULACBO_DatNT c1 ON TRANDAU_DatNT.MACLB1_4242 = c1.MACLB_4242)
INNER JOIN CAULACBO_DatNT c2 ON TRANDAU_DatNT.MACLB2_4242 = c2.MACLB_4242)
WHERE VONG_4242 = 2 AND NAM_4242 = 2009;

--7. Cho biết kết quả (MATRAN, NGAYTD, TENSAN, TENCLB1, TENCLB2, KETQUA) các trận đấu vòng 2 của mùa bóng năm 2009
SELECT MATRAN_4242, NGAYTD_4242, TENSAN_4242, c1.TENCLB_4242, c2.TENCLB_4242, KETQUA_4242
FROM TRANDAU_DatNT, SANVD_DatNT, CAULACBO_DatNT as c1, CAULACBO_DatNT as c2
WHERE TRANDAU_DatNT.MASAN_4242 = SANVD_DatNT.MASAN_4242
AND TRANDAU_DatNT.MACLB1_4242 = c1.MACLB_4242
AND TRANDAU_DatNT.MACLB2_4242 = c2.MACLB_4242
AND VONG_4242 = 2 AND NAM_4242 = 2009; 

--8. Cho biết mã huấn luyện viên, họ tên, ngày sinh, địa chỉ, vai trò và tên CLB đang làm veiecj của các huấn luyện viên có quốc tịch “ViệtNam”
SELECT HUANLUYENVIEN_DatNT.MAHLV_4242,HLV_CLB_DatNT.MAHLV_4242,TENHLV_4242, NGAYSINH_4242, DIACHI_4242, VAITRO_4242
FROM (((HUANLUYENVIEN_DatNT
INNER JOIN HLV_CLB_DatNT ON HUANLUYENVIEN_DatNT.MAHLV_4242 = HLV_CLB_DatNT.MAHLV_4242)
INNER JOIN QUOCGIA_DatNT ON HUANLUYENVIEN_DatNT.MAQG_4242 = QUOCGIA_DatNT.MAQG_4242)
INNER JOIN CAULACBO_DatNT ON HLV_CLB_DatNT.MACLB_4242 = CAULACBO_DatNT.MACLB_4242)
WHERE TENQG_4242 = N'Việt Nam';

--9. Lấy tên 3 câu lạc bộ có điểm cao nhất sau vòng 3 năm 2009
SELECT TOP 3 TENCLB_4242, SUM(DIEM_4242) AS "DIEM"
FROM CAULACBO_DatNT, BANGXH_DatNT
WHERE CAULACBO_DatNT.MACLB_4242 = BANGXH_DatNT.MACLB_4242
AND VONG_4242 <= 3 AND NAM_4242 = 2009
GROUP BY TENCLB_4242
ORDER BY SUM(DIEM_4242) DESC;

--10. Cho biết mã huấn luyện viên, họ tên, ngày sinh, địa chỉ, vai trò và tên CLB đang làm việc mà câu lạc bộ đó đóng ở tỉnh Binh Dương.
SELECT HUANLUYENVIEN_DatNT.MAHLV_4242, TENHLV_4242, NGAYSINH_4242, DIACHI_4242, VAITRO_4242, TENCLB_4242
FROM HLV_CLB_DatNT, CAULACBO_DatNT, HUANLUYENVIEN_DatNT, TINH_DatNT
WHERE HUANLUYENVIEN_DatNT.MAHLV_4242 = HLV_CLB_DatNT.MAHLV_4242
AND HLV_CLB_DatNT.MACLB_4242 = CAULACBO_DatNT.MACLB_4242
AND CAULACBO_DatNT.MATINH_4242 = TINH_DatNT.MATINH_4242
AND TENTINH_4242 = N'Bình Dương';

--b. Các phép toán trên nhóm
--1. Thống kê số lượng cầu thủ của mỗi câu lạc bộ
SELECT TENCLB_4242, COUNT(*) AS SOCAUTHU
FROM CAUTHU_DatNT INNER JOIN CAULACBO_DatNT ON CAUTHU_DatNT.MACLB_4242 = CAULACBO_DatNT.MACLB_4242
GROUP BY TENCLB_4242;

--2. Thống kê số lượng cầu thủ có quốc tịch Việt Nam của mỗi câu lạc bộ
SELECT TENCLB_4242, COUNT(*)
FROM ((CAUTHU_DatNT
INNER JOIN QUOCGIA_DatNT ON CAUTHU_DatNT.MAQG_4242 = QUOCGIA_DatNT.MAQG_4242)
INNER JOIN CAULACBO_DatNT ON CAUTHU_DatNT.MACLB_4242 = CAULACBO_DatNT.MACLB_4242)
WHERE TENQG_4242 = N'Việt Nam'
GROUP BY TENCLB_4242;


--3. Cho biết mã câu lạc bộ, tên câu lạc bộ, tên sân vận động, địa chỉ và số lượng cầu thủ
--nước ngoài (có quốc tịch khác Việt Nam) tương ứng của các câu lạc bộ có nhiều hơn 2 cầu thủ nước ngoài
INSERT INTO CAUTHU_DatNT (HOTEN_4242, VITRI_4242, NGAYSINH_4242, DIACHI_4242, MACLB_4242, MAQG_4242, SO_4242)
VALUES (N'Đạt Pogba 20194242', N'Tiền đạo cắm', '2001-6-9', NULL, 'SDN', 'ITA', 96);
SELECT CAULACBO_DatNT.MACLB_4242, TENCLB_4242, TENSAN_4242, SANVD_DatNT.DIACHI_4242, COUNT(*) AS SOCAUTHUNGOAI
FROM (((CAULACBO_DatNT
INNER JOIN SANVD_DatNT ON CAULACBO_DatNT.MASAN_4242 = SANVD_DatNT.MASAN_4242)
INNER JOIN CAUTHU_DatNT ON CAULACBO_DatNT.MACLB_4242 = CAUTHU_DatNT.MACLB_4242)
INNER JOIN QUOCGIA_DatNT ON CAUTHU_DatNT.MAQG_4242 = QUOCGIA_DatNT.MAQG_4242)
WHERE TENQG_4242 <> N'Việt Nam'
GROUP BY CAULACBO_DatNT.MACLB_4242, TENCLB_4242, TENSAN_4242, SANVD_DatNT.DIACHI_4242 HAVING COUNT(*) > 2

--4. Cho biết tên tỉnh, số lượng cầu thủ đang thi đấu ở vị trí tiền đạo trong các câu lạc bộ thuộc địa bàn tỉnh đó quản lý
SELECT TENTINH_4242, TENCLB_4242, COUNT(*) AS SOTIENDAO
FROM CAUTHU_DatNT, CAULACBO_DatNT, TINH_DatNT
WHERE CAUTHU_DatNT.MACLB_4242 = CAULACBO_DatNT.MACLB_4242
AND CAULACBO_DatNT.MATINH_4242 = TINH_DatNT.MATINH_4242
AND CAUTHU_DatNT.VITRI_4242 = N'Tiền đạo'
GROUP BY TENTINH_4242, TENCLB_4242;


--5. Cho biết tên câu lạc bộ, tên tỉnh mà CLB đang đóng nằm ở vị trí cao nhất của bảng xếp hạng vòng 3, năm 2009
SELECT TOP 1 TENCLB_4242, TENTINH_4242
FROM CAULACBO_DatNT, TINH_DatNT, BANGXH_DatNT
WHERE CAULACBO_DatNT.MACLB_4242 = BANGXH_DatNT.MACLB_4242
AND CAULACBO_DatNT.MATINH_4242 = TINH_DatNT.MATINH_4242
AND VONG_4242 = 3 AND NAM_4242 = 2009
ORDER BY HANG_4242 ASC;


INSERT INTO HUANLUYENVIEN_DatNT (MAHLV_4242, TENHLV_4242, MAQG_4242)
VALUES ('HLV07', N'Nguyễn Tiến Đạt', 'VN');
INSERT INTO HLV_CLB_DatNT (MAHLV_4242, MACLB_4242, VAITRO_4242)
VALUES ('HLV07', 'HAGL', N'HLV phụ');
INSERT INTO HUANLUYENVIEN_DatNT (MAHLV_4242, TENHLV_4242, NGAYSINH_4242, DIACHI_4242, DIENTHOAI_4242, MAQG_4242)
VALUES ('HLV08', N'Nguyễn Hồng Sơn', '1970-10-9', NULL, '12345678910', 'VN');

--c. Các toán tử nâng cao
--1. Cho biết tên huấn luyện viên đang nắm giữ một vị trí trong một câu lạc bộ mà chưa có số điện thoại
SELECT TENHLV_4242
FROM HUANLUYENVIEN_DatNT
WHERE MAHLV_4242 IN (SELECT MAHLV_4242 FROM HLV_CLB_DatNT)
AND DIENTHOAI_4242 IS NULL;

--2. Liệt kê các huấn luyện viên thuộc quốc gia Việt Nam chưa làm công tác huấn luyện tại bất kỳ một câu lạc bộ nào
SELECT MAHLV_4242, TENHLV_4242
FROM HUANLUYENVIEN_DatNT, QUOCGIA_DatNT
WHERE MAHLV_4242 
NOT IN (SELECT MAHLV_4242 FROM HLV_CLB_DatNT)
AND HUANLUYENVIEN_DatNT.MAQG_4242 = QUOCGIA_DatNT.MAQG_4242
AND TENQG_4242 = N'Việt Nam';

--3. Liệt kê các cầu thủ đang thi đấu trong các câu lạc bộ có thứ hạng ở vòng 3 năm 2009 lớn hơn 6 hoặc nhỏ hơn 3
SELECT HOTEN_4242, TENCLB_4242, HANG_4242
FROM CAUTHU_DatNT, CAULACBO_DatNT, BANGXH_DatNT
WHERE CAUTHU_DatNT.MACLB_4242 = CAULACBO_DatNT.MACLB_4242
AND CAULACBO_DatNT.MACLB_4242 = BANGXH_DatNT.MACLB_4242
AND VONG_4242 = 3 AND NAM_4242 = 2009
AND (HANG_4242 > 6 OR HANG_4242 < 3);

--4. Cho biết danh sách các trận đấu (NGAYTD, TENSAN, TENCLB1, TENCLB2, KETQUA)
--của câu lạc bộ (CLB) đang xếp hạng cao nhất tính đến hết vòng 3 năm 2009.
SELECT NGAYTD_4242, TENSAN_4242, c1.TENCLB_4242, c2.TENCLB_4242, KETQUA_4242
FROM (((TRANDAU_DatNT
INNER JOIN SANVD_DatNT ON TRANDAU_DatNT.MASAN_4242 = SANVD_DatNT.MASAN_4242)
INNER JOIN CAULACBO_DatNT c1 ON TRANDAU_DatNT.MACLB1_4242 = c1.MACLB_4242)
INNER JOIN CAULACBO_DatNT c2 ON TRANDAU_DatNT.MACLB2_4242 = c2.MACLB_4242)
WHERE 
(SELECT TOP 1 MACLB_4242 FROM BANGXH_DatNT WHERE VONG_4242 = 3 AND NAM_4242 = 2009 ORDER BY HANG_4242) IN (c1.MACLB_4242, c2.MACLB_4242)